name: Odoo.sh Deploy
on: [push]
jobs:
  Odoo-SH-Wait-Restart:
    runs-on: ubuntu-latest
    environment: ${{ github.ref_name }}
    steps:
      - name: Wait Odoo.Sh restart instance
        uses: halgandd/odoo-sh-wait-restart@v1
        env:
          INSTANCE_NAME: '${{secrets.ODOOSH_INSTANCE_NAME}}'
          PRIVATE_KEY: '${{secrets.SSH_PRIVATE_KEY}}'

  Odoo-SH-Update-All:
    needs: Odoo-SH-Wait-Restart
    runs-on: ubuntu-latest
    environment: ${{ github.ref_name }}
    steps:
      - name: Update All
        uses: halgandd/odoo-sh-update-all@v1
        env:
          INSTANCE_NAME: '${{secrets.ODOOSH_INSTANCE_NAME}}'
          PRIVATE_KEY: '${{secrets.SSH_PRIVATE_KEY}}'

  Odoo-SH-Shell:
    needs: Odoo-SH-Update-All
    runs-on: ubuntu-latest
    environment: ${{ github.ref_name }}
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 1
      - name: Odoo Shell Init
        uses: halgandd/odoo-sh-shell@v1
        with:
          script: .github/odoo_init.py
        env:
          INSTANCE_NAME: '${{secrets.ODOOSH_INSTANCE_NAME}}'
          PRIVATE_KEY: '${{secrets.SSH_PRIVATE_KEY}}'
      - name: Odoo Shell Install
        uses: halgandd/odoo-sh-shell@v1
        with:
          script: .github/odoo_install.py
        env:
          INSTANCE_NAME: '${{secrets.ODOOSH_INSTANCE_NAME}}'
          PRIVATE_KEY: '${{secrets.SSH_PRIVATE_KEY}}'




